<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Ford Demo Scanner</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

<style>
    /* --- RESET --- */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    :root { --ford-blue: #003478; --bg-gray: #f4f5f8; --success: #2e7d32; }
    
    body {
        font-family: "Ford Antenna", -apple-system, BlinkMacSystemFont, Roboto, sans-serif; 
        background: var(--bg-gray);
        display: flex; flex-direction: column; align-items: center;
        padding: 20px; margin: 0; min-height: 100vh;
    }

    .scanner-widget {
        background: white; width: 100%; max-width: 360px;
        border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        overflow: hidden; display: flex; flex-direction: column;
        height: 500px; /* Fixed Height */
        position: relative;
    }

    .widget-header {
        background: var(--ford-blue); color: white; padding: 15px;
        font-weight: 700; text-transform: uppercase; text-align: center; letter-spacing: 0.5px;
        height: 50px; /* Fixed header height */
        display: flex; align-items: center; justify-content: center;
    }

    /* --- SCREENS --- */
    .screen {
        display: none; width: 100%; height: 100%;
        flex-direction: column;
        animation: fadeIn 0.3s ease;
    }
    .screen.active { display: flex; }

    /* Centered Layouts (Idle/Result) */
    #screen-idle, #screen-result, #screen-camera {
        align-items: center; justify-content: center; padding: 20px;
    }

    /* --- FAKE PDF LAYOUT (The Fix) --- */
    #screen-pdf {
        background: #525659;
        display: none; /* Hidden by default */
        flex-direction: column;
        height: 450px; /* 500px widget - 50px header = 450px remaining */
    }
    #screen-pdf.active { display: flex; }

    .pdf-toolbar {
        width: 100%; height: 40px; 
        background: #323639; color: white; padding: 0 15px;
        display: flex; justify-content: space-between; align-items: center; 
        font-size: 12px; font-weight: 600;
        flex-shrink: 0;
    }

    .pdf-content {
        width: 100%;
        /* CALCULATED HEIGHT: 450px space - 40px toolbar = 410px scroll area */
        height: 410px; 
        
        background: #525659;
        padding: 20px;
        
        /* SCROLL TRAP FIXES */
        overflow-y: auto; 
        -webkit-overflow-scrolling: touch; 
        overscroll-behavior: contain; /* Prevents app from stealing scroll */
        touch-action: pan-y; /* Enables vertical drag */
        
        display: block; /* Simpler than flex for scrolling */
    }

    .doc-page {
        width: 100%; max-width: 300px; 
        background: white; border: 1px solid #ccc;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3); 
        padding: 25px; margin: 0 auto 20px auto; /* Centered */
    }

    /* --- UI ELEMENTS --- */
    .btn-primary {
        background: var(--ford-blue); color: white; border: none;
        padding: 14px; border-radius: 8px; font-weight: 700;
        cursor: pointer; margin-top: 15px; width: 100%; font-size: 16px;
    }
    .btn-success {
        background: var(--success); color: white; border: none;
        padding: 14px; width: 100%; border-radius: 8px; font-weight: 700;
        cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
        font-size: 16px; margin-top: 15px;
    }

    #reader { width: 100%; height: 250px; background: black; border-radius: 8px; margin-bottom: 15px; }

    .asset-card {
        width: 100%; border: 1px solid #ddd; border-left: 5px solid var(--success);
        background: #f9fff9; padding: 15px; border-radius: 4px; text-align: left;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

<div class="scanner-widget">
    <div class="widget-header">Equipment Lookup</div>

    <div id="screen-idle" class="screen active">
        <svg style="width:60px;height:60px;fill:#999;margin-bottom:15px;" viewBox="0 0 24 24"><path d="M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"/></svg>
        <p style="color:#555; font-size:14px; text-align:center;">Scan equipment tag to view safety manuals.</p>
        <button class="btn-primary" onclick="goToCamera()">Start Scanner</button>
    </div>

    <div id="screen-camera" class="screen">
        <div id="reader"></div>
        <button onclick="goToIdle()" style="background:#eee; border:none; padding:12px; width:100%; border-radius:8px; font-weight:600; color:#333;">Cancel</button>
    </div>

    <div id="screen-result" class="screen">
        <div class="asset-card">
            <div style="background:#c8e6c9; color:#2e7d32; padding:3px 8px; border-radius:4px; font-size:11px; font-weight:700; text-transform:uppercase; display:inline-block; margin-bottom:8px;">✓ Manual Found</div>
            <div style="font-size:18px; font-weight:800; color:#1a1a1a; margin-bottom:5px;" id="res-name">Loading...</div>
            <div style="font-size:13px; color:#666; margin-bottom:5px;" id="res-id">ID: ...</div>
        </div>
        <button class="btn-success" onclick="goToPDF()">
            <svg style="width:20px;height:20px;fill:white" viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
            View Document
        </button>
        <div style="margin-top:20px; text-align:center;">
            <span style="font-size:14px; color:#003478; text-decoration:underline; cursor:pointer;" onclick="goToCamera()">Scan Next Item</span>
        </div>
    </div>

    <div id="screen-pdf">
        <div class="pdf-toolbar">
            <span id="pdf-filename">Safety_Manual_v4.pdf</span>
            <span onclick="goToResult()" style="cursor:pointer; font-weight:bold; padding:5px;">✕ Close</span>
        </div>
        <div class="pdf-content">
            
            <div class="doc-page">
                <h2 style="margin-top:0; color:#d32f2f; border-bottom:2px solid #ddd; padding-bottom:10px;">DANGER / LOCKOUT</h2>
                <p style="font-size:12px; font-weight:bold;">Equipment: Hydraulic Press Series A</p>
                <p style="font-size:11px; color:#333; line-height:1.6;">
                    <strong>1. SHUTDOWN:</strong> Ensure all primary energy sources are disconnected before servicing.<br><br>
                    <strong>2. ISOLATION:</strong> Apply locks to the main breaker (Panel 4B).<br><br>
                    <strong>3. VERIFICATION:</strong> Attempt to start the equipment to verify zero energy state.
                </p>
                <div style="background:#eee; height:80px; margin-top:15px; display:flex; align-items:center; justify-content:center; color:#999; font-size:10px;">[ DIAGRAM A-42 ]</div>
            </div>

            <div class="doc-page">
                 <h3 style="margin-top:0;">Maintenance Log</h3>
                 <p style="font-size:10px; color:#666;">Last Service: 10/12/2025 by J. Doe</p>
                 <table style="width:100%; font-size:10px; margin-top:10px; border-collapse:collapse;">
                     <tr style="background:#f0f0f0;"><td style="padding:5px;">Date</td><td style="padding:5px;">Check</td></tr>
                     <tr><td style="padding:5px; border-bottom:1px solid #eee;">10/12</td><td style="padding:5px; border-bottom:1px solid #eee;">Oil Level OK</td></tr>
                     <tr><td style="padding:5px; border-bottom:1px solid #eee;">09/01</td><td style="padding:5px; border-bottom:1px solid #eee;">Filter Replaced</td></tr>
                 </table>
            </div>

            <div style="color:#ccc; font-size:10px; text-align:center; padding-bottom:10px;">End of Document</div>
        </div>
    </div>

</div>

<script>
    let html5QrCode;

    function goToIdle() { switchScreen('screen-idle'); }
    function goToCamera() { switchScreen('screen-camera'); startScanner(); }
    function goToResult() { switchScreen('screen-result'); }
    function goToPDF() { 
        // Force scroll to top when opening PDF
        const content = document.querySelector('.pdf-content');
        if(content) content.scrollTop = 0;
        
        // Manual toggle because PDF screen is special
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById('screen-pdf').style.display = 'flex'; // Explicit display set
    }

    function switchScreen(id) {
        if(id !== 'screen-camera' && html5QrCode) { try { html5QrCode.stop(); } catch(e) {} }
        
        // Hide PDF specifically since it has custom display logic
        document.getElementById('screen-pdf').style.display = 'none';
        
        document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function startScanner() {
        html5QrCode = new Html5Qrcode("reader");
        html5QrCode.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 200, height: 200 } }, onScanSuccess);
    }

    function onScanSuccess(decodedText) {
        html5QrCode.stop().then(() => {
            document.getElementById('res-name').innerText = "Hydraulic Press #4";
            document.getElementById('res-id').innerText = "ID: " + decodedText;
            goToResult();
        });
    }
</script>

</body>
</html>
